---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getPeople, getPersonBySlug } from '@/lib/payload';

export async function getStaticPaths() {
  const people = await getPeople({ limit: 1000 });
  
  return people.docs.map((person) => ({
    params: { slug: person.slug },
    props: { person },
  }));
}

const { person } = Astro.props;
const personData = person || await getPersonBySlug(Astro.params.slug);

if (!personData) {
  return Astro.redirect('/404');
}

const title = personData.meta?.title || personData.name;
const description = personData.meta?.description || personData.shortBio || '';
---

<BaseLayout title={title} description={description} image={personData.portrait?.url}>
  <article class="py-16">
    <div class="container max-w-4xl">
      <div class="grid gap-12 md:grid-cols-3">
        <!-- Portrait -->
        <div>
          {personData.portrait?.url && (
            <div class="overflow-hidden rounded-xl">
              <img 
                src={personData.portrait.url} 
                alt={personData.name}
                class="w-full h-auto"
              />
            </div>
          )}
        </div>
        
        <!-- Details -->
        <div class="md:col-span-2">
          <h1 class="text-3xl font-bold tracking-tight lg:text-4xl">{personData.name}</h1>
          
          <div class="mt-4 space-y-2 text-gray-500 dark:text-gray-400">
            {(personData.birthDate || personData.deathDate) && (
              <p>
                {personData.birthDate}
                {personData.birthDate && personData.deathDate && ' – '}
                {personData.deathDate}
              </p>
            )}
            {personData.nationality && <p>{personData.nationality}</p>}
          </div>
          
          {personData.role && personData.role.length > 0 && (
            <div class="mt-4 flex flex-wrap gap-2">
              {personData.role.map((role: string) => (
                <span class="rounded-full bg-blue-100 px-3 py-1 text-sm font-medium capitalize text-blue-700 dark:bg-blue-900 dark:text-blue-300">
                  {role}
                </span>
              ))}
            </div>
          )}
          
          {personData.shortBio && (
            <p class="mt-6 text-lg text-gray-600 dark:text-gray-300">{personData.shortBio}</p>
          )}
          
          {personData.biography_html && (
            <div class="mt-8 prose-custom" set:html={personData.biography_html} />
          )}
        </div>
      </div>
      
      <!-- Back link -->
      <div class="mt-12">
        <a href="/people" class="text-blue-600 hover:text-blue-700 dark:text-blue-400">
          ← Back to People
        </a>
      </div>
    </div>
  </article>
</BaseLayout>

---
/**
 * Gallery Block Component
 * 
 * Image gallery with multiple layout options.
 */

interface Props {
  heading?: string;
  images?: Array<{
    image: {
      url: string;
      alt?: string;
      width?: number;
      height?: number;
    };
    caption?: string;
  }>;
  layout?: 'grid' | 'masonry' | 'carousel' | 'lightbox';
  columns?: 2 | 3 | 4;
}

const { heading, images = [], layout = 'grid', columns = 3 } = Astro.props;

if (images.length === 0) return null;

const columnClasses: Record<number, string> = {
  2: 'grid-cols-1 sm:grid-cols-2',
  3: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3',
  4: 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-4',
};
---

<section class="py-12">
  <div class="container">
    {heading && (
      <h2 class="text-2xl font-bold mb-8 text-center">{heading}</h2>
    )}
    
    {layout === 'grid' && (
      <div class={`grid gap-4 ${columnClasses[columns]}`}>
        {images.map(({ image, caption }) => (
          <figure class="group relative overflow-hidden rounded-lg">
            <img 
              src={image.url} 
              alt={image.alt || ''} 
              class="w-full h-64 object-cover transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
            />
            {caption && (
              <figcaption class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 text-white text-sm opacity-0 group-hover:opacity-100 transition-opacity">
                {caption}
              </figcaption>
            )}
          </figure>
        ))}
      </div>
    )}
    
    {layout === 'masonry' && (
      <div class={`columns-1 sm:columns-2 lg:columns-${columns} gap-4`}>
        {images.map(({ image, caption }) => (
          <figure class="mb-4 break-inside-avoid">
            <img 
              src={image.url} 
              alt={image.alt || ''} 
              class="w-full rounded-lg"
              loading="lazy"
            />
            {caption && (
              <figcaption class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                {caption}
              </figcaption>
            )}
          </figure>
        ))}
      </div>
    )}
    
    {layout === 'carousel' && (
      <div class="relative overflow-x-auto pb-4">
        <div class="flex gap-4 snap-x snap-mandatory">
          {images.map(({ image, caption }) => (
            <figure class="flex-none w-80 snap-center">
              <img 
                src={image.url} 
                alt={image.alt || ''} 
                class="w-full h-60 object-cover rounded-lg"
                loading="lazy"
              />
              {caption && (
                <figcaption class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                  {caption}
                </figcaption>
              )}
            </figure>
          ))}
        </div>
      </div>
    )}
    
    {layout === 'lightbox' && (
      <div class={`grid gap-2 ${columnClasses[columns]}`}>
        {images.map(({ image, caption }, index) => (
          <a 
            href={image.url} 
            class="block group relative overflow-hidden rounded-lg"
            data-lightbox="gallery"
            data-caption={caption}
          >
            <img 
              src={image.url} 
              alt={image.alt || ''} 
              class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
            />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center">
              <span class="text-white text-2xl opacity-0 group-hover:opacity-100 transition-opacity">üîç</span>
            </div>
          </a>
        ))}
      </div>
    )}
  </div>
</section>

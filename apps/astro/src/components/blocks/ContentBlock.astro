---
/**
 * Content Block Component
 * 
 * Rich text content with optional columns layout.
 */

interface Props {
  content?: any; // Lexical rich text
  columns?: 'one' | 'two' | 'three';
  backgroundColor?: string;
}

const { content, columns = 'one', backgroundColor } = Astro.props;

// Simple rich text renderer for Lexical content
function renderRichText(node: any): string {
  if (!node) return '';
  
  if (typeof node === 'string') return node;
  
  if (Array.isArray(node)) {
    return node.map(renderRichText).join('');
  }
  
  if (node.type === 'text') {
    let text = node.text || '';
    if (node.format & 1) text = `<strong>${text}</strong>`; // Bold
    if (node.format & 2) text = `<em>${text}</em>`; // Italic
    if (node.format & 8) text = `<u>${text}</u>`; // Underline
    return text;
  }
  
  const children = node.children ? renderRichText(node.children) : '';
  
  switch (node.type) {
    case 'root':
      return children;
    case 'paragraph':
      return `<p>${children}</p>`;
    case 'heading':
      const tag = `h${node.tag?.replace('h', '') || '2'}`;
      return `<${tag}>${children}</${tag}>`;
    case 'list':
      const listTag = node.listType === 'number' ? 'ol' : 'ul';
      return `<${listTag}>${children}</${listTag}>`;
    case 'listitem':
      return `<li>${children}</li>`;
    case 'link':
      return `<a href="${node.fields?.url || '#'}" target="${node.fields?.newTab ? '_blank' : '_self'}">${children}</a>`;
    case 'quote':
      return `<blockquote>${children}</blockquote>`;
    default:
      return children;
  }
}

const columnClasses: Record<string, string> = {
  one: 'columns-1',
  two: 'md:columns-2 gap-8',
  three: 'md:columns-3 gap-6',
};

const htmlContent = content?.root ? renderRichText(content.root) : '';
---

<section 
  class="py-12"
  style={backgroundColor ? `background-color: ${backgroundColor};` : ''}
>
  <div class="container">
    <div 
      class={`prose prose-lg max-w-none dark:prose-invert ${columnClasses[columns]}`}
      set:html={htmlContent}
    />
  </div>
</section>
